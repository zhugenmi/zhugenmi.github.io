---
title: 【C++】友元类和嵌套类
author: zhugenmi
date: 2024-10-13
categories: [C++, C++ Primer]
tags: [c++]
---

友元类、友元成员函数和嵌套类是在其他类中声明的类。

## 友元

可以将类作为友元，在这种情况下，友元类的所有方法都可以访问原始类的私有成员和保护成员。也可以只将特定的成员函数指定为另一个类的友元。

**当函数需要访问两个类的私有数据时，这就需要使用友元。**

例如，假定有一个Probe类和一个Analyzer类，前者表示某种可编程的测量设备，后者表示某种可编程的分析设备。这两个类都有内部时钟，且希望它们能够同步，则应包含下述代码行：

```cpp
class Analyzer; //forward declaration前向声明
class Probe
{
  friend void sync(Analyzer &a, const Probe &p);  //sync a to p
  friend void sync(Probe &p, const Analyzer &a); //sync p to a
   …
};
class Analyzer
{
  friend void sync(Analyzer &a, const Probe &p); //sync a to p
  friend void sync(Probe &p, const Analyzer &a); //sync p to a
   …
};
//define the friend functions
inline void sync(Analyzer &a, const Probe &p)
{
…
}
inline void sync (Probe &p, const Analyzer &a)
{
…
}
```

## 嵌套类

### 概念

在C++中，可以将类声明放在另一个类中。在另一个类中声明的类被称为嵌套类（nested class），它通过提供新的类型类作用域来避免名称混乱。

包含类的成员函数可以创建和使用被嵌套类的对象；而仅当声明位于公有部分，才能在包含类的外面使用嵌套类，而且必须使用作用域解析运算符。

对类进行嵌套与包含并不相同。包含意味着将类对象作为另一个类的成员，而对类进行嵌套不创建类成员，而是定义了一种类型，该类型仅在包含嵌套类声明中的类有效。

嵌套类的声明位置决定了嵌套类的作用域，即它决定了程序的哪些部分可以创建这种类的对象。和其它类一样，嵌套类的共有部分、保护部分和私有部分控制了对类成员的访问。在哪些地方可以使用嵌套类以及如何使用嵌套类，取决于作用域和访问控制。

### 作用域

由于嵌套类的作用域为包含它的类，因此在外部世界使用它时，必须使用类限定符。嵌套结构和枚举的作用域与此相同，很多程序员都使用公有枚举来提供可供客户程序员使用的类常数。

| 声明位置 | 包含它的类是否可以使用它 | 从包含它的类派生而来的类是否可以使用它 | 在外部是否可以使用     |
| -------- | ------------------------ | -------------------------------------- | ---------------------- |
| 私有部分 | 是                       | 否                                     | 否                     |
| 保护部分 | 是                       | 是                                     | 否                     |
| 公有部分 | 是                       | 是                                     | 是，通过类限定符来使用 |

### 访问控制

类声明的位置决定了类的作用域或可见性。类可见后，访问控制规则（公有、保护、私有、友元）将决定程序对嵌套类成员的访问权限。