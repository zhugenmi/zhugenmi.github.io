---
title: C语言结构与语法
author: zhugenmi
date: 2024-11-1 22:20 +0800
categories: [C/C++, C语言编程]
tags: [c]
description: 
---

一个C语言程序完整的编程的过程是：

- 编写源文件：这是编程的主要工作，我们要保证代码的语法100%正确，不能有任何差错；

- 编译：将源文件转换为目标文件；

- 链接：将目标文件和系统库组合在一起并转换为可执行文件；

- 运行：可以检验代码的正确性。

不过，实际开发中我们最常用的是“运行”按钮或F5快捷键，它会一次性完成编译、链接和运行的操作，并让程序运行结束后自动暂停。

## 基本语法

### 程序组成

C程序代码可以是关键字、标识符、常量、字符串值，或者是一个符号。

- 分号` ;`
  在 C 程序中，分号是语句结束符。

- 注释
  注释就像是 C 程序中的帮助文本，它们会被编译器忽略。它们以 `/*` 开始，以字符` */` 终止

- 标识符

  （1）C 标识符是用来标识变量、函数，或任何其他用户自定义项目的名称。一个标识符以字母 A-Z 或 a-z 或下划线 _ 开始，后跟零个或多个字母、下划线和数字（0-9）。
  （2）C 标识符内不允许出现标点字符，比如 @、$ 和 %。
  （3）C 是区分大小写的编程语言。因此，在 C 中，A 和 a是两个不同的标识符。

- 关键字
  下面列出了C中的保留字。这些保留字不能作为常量名、变量名或其他标识符名称。

  auto、else、long、switch、break、enum、register、typedef、case、extern、return、union、char、float、short、unsigned、const、for、signed、void、continue、goto、sizeof、volatile、default、if、static、while、do、int、struct、_packed、double

  > 在C语言中，__packed关键字（在某些上下文中也可能写作__attribute__((packed))，这取决于编译器）是一个用于结构体和联合体（union）定义的属性，其主要作用是取消编译器的默认内存对齐行为。这一关键字的使用场景和重要性尤其是在对存储空间敏感的环境中，如嵌入式系统，或者需要精确控制内存布局的应用中。

- 空格

  在 C 中，空格用于描述空白符、制表符、换行符和注释。空格分隔语句的各个部分，让编译器能识别语句中的某个元素（比如 int）在哪里结束，下一个元素在哪里开始。

### 数据类型

在C语言中，数据类型指的是用于声明不同类型的变量或函数的一个广泛的系统。变量的类型决定了变量存储占用的空间，以及如何解释存储的位模式。C中的类型可分为以下几种：

- 基本类型：算术类型，包括整数类型和浮点类型两种。
- 枚举类型：算术类型，被用来定义在程序中只能赋予其一定的离散整数值的变量。
- `void `类型：类型说明符 `void `表明没有可用的值。
- 派生类型：它们包括：指针类型、数组类型、结构类型、共用体类型和函数类型。

基本数据类型的典型大小（以字节为单位）：

| 有符号        | 无符号         | 32位 | 64位                 |
| ------------- | -------------- | ---- | -------------------- |
| (signed) char | unsigned char  | 1    | 1                    |
| short         | unsigned short | 2    | 2                    |
| int           | unsigned int   | 4    | 4                    |
| long          | unsigned long  | 4    | 8                    |
| int32_t       | uint32_t       | 4    | 4                    |
| int64_t       | uint64_t       | 8    | 8                    |
| char*         |                | 4    | 8                    |
| float         |                | 4    | 4（精度：6位小数）   |
| double        |                | 8    | 8（精度：15位小数）  |
| long double   |                |      | 16（精度：19位小数） |

> 为了得到某个类型或某个变量在特定平台上的准确大小，可以使用 sizeof 运算符。表达式 sizeof(type) 得到对象或类型的存储字节大小。

`void` 类型指定没有可用的值。它通常用于以下三种情况下：

1. 函数返回为空：C 中有各种函数都不返回值，或者您可以说它们返回空。不返回值的函数的返回类型为空。
   例如 `void exit (int status);`
2. 函数参数为空：C 中有各种函数不接受任何参数。不带参数的函数可以接受一个 void。
   例如` int rand(void);`
3. 指针指向 `void`：类型为 `void *` 的指针代表对象的地址，而不是类型。
   例如：内存分配函数` void *malloc( size_t size );` 返回指向 `void` 的指针，可以转换为任何数据类型。

### 变量

变量其实不过是程序可操作的存储区的名称。C 中每个变量都有特定的类型，类型决定了变量存储的大小和布局，该范围内的值都可以存储在内存中，运算符可应用于变量上。

变量的名称可以由字母、数字和下划线字符组成。它必须以字母或下划线开头。大写字母和小写字母是不同的，因为C是大小写敏感的。

变量定义及初始化：

```c
extern int d = 3, f = 5; // d 和 f 的声明, 这就是单纯的声明
int d = 3, f = 5; // 定义并初始化 d 和 f
byte z = 22; // 定义并初始化 z
char x = 'x'; // 变量 x 的值为 'x'
```

> 注意：静态变量和全局变量默认的初始化的值为0。其他局部变量默认初始化都是未知值。

变量的声明有两种情况：
1、一种是需要建立存储空间的。例如：`int a` 在声明的时候就已经建立了存储空间。
2、另一种是不需要建立存储空间的，通过使用`extern`关键字声明变量名而不定义它。 例如：`extern int a` 其中变量 `a` 可以在别的文件中定义的。

```c
extern int i; //声明，不是定义
int i; //声明，也是定义
```

### 左值和右值

C 中有两种类型的表达式：

- 左值（lvalue）：指向内存位置的表达式被称为左值（lvalue）表达式。左值可以出现在赋值号的左边或右边。
- 右值（rvalue）：指的是存储在内存中某些地址的数值。右值是不能对其进行赋值的表达式，也就是说，右值可以出现在赋值号的右边，但不能出现在赋值号的左边。

变量是左值，因此可以出现在赋值号的左边。数值型的字面值是右值，因此不能被赋值，不能出现在赋值号的左边。

### 常量

常量是固定值，在程序执行期间不会改变。这些固定的值，又叫做字面量。常量可以是任何的基本数据类型，比如整数常量、浮点常量、字符常量，或字符串字面值，也有枚举常量。

#### 整数常量

整数常量可以是十进制、八进制或十六进制的常量。前缀指定基数：0x 或 0X 表示十六进制，0 表示八进制，不带前缀则默认表示十进制。

整数常量也可以带一个后缀，后缀是 U 和 L 的组合，U 表示无符号整数（unsigned），L 表示长整数（long）。后缀可以是大写，也可以是小写，U 和 L 的顺序任意。

```c
85		/* 十进制 */
0213	/* 八进制 */
0x4b	/* 十六进制 */
30		/* 整数 */
30u		/* 无符号整数 */
30l		/* 长整数 */
30ul	/* 无符号长整数 */
```

#### 浮点常量

浮点常量由整数部分、小数点、小数部分和指数部分组成。可以使用小数形式或者指数形式来表示浮点常量。

当使用小数形式表示时，必须包含整数部分、小数部分，或同时包含两者。当使用指数形式表示时， 必须包含小数点、指数，或同时包含两者。带符号的指数是用 e 或 E 引入的。

```c
3.14159		/* 合法的 */
314159E-5L	/* 合法的 */
510E		/* 非法的：不完整的指数 */
210f		/* 非法的：没有小数或指数 */
.e55		/* 非法的：缺少整数或分数 */
```

#### 字符常量

字符常量是括在单引号中，例如，`'x'` 可以存储在 `char `类型的简单变量中。

字符常量可以是一个普通的字符（例如 `'x'`）、一个转义序列（例如 `'\t'`），或一个通用的字符（例如 `'\u02C0'`）。

在 C 中，有一些特定的字符，当它们前面有反斜杠时，它们就具有特殊的含义，被用来表示如换行符（`\n`）或制表符（`\t`）等。

| 转义字符  | 含义                       |
| --------- | -------------------------- |
| `\\`      | `\`字符                    |
| `\'`      | `'`字符                    |
| `\"`      | `"`字符                    |
| `\?`      | `?`字符                    |
| `\a`      | 警报铃声                   |
| `\b`      | 退格键                     |
| `\f`      | 换页符                     |
| `\n`      | 换行符                     |
| `\r`      | 回车                       |
| `\t`      | 水平制表符                 |
| `\v`      | 垂直制表符                 |
| `\ooo`    | 一到三位的八进制数         |
| `\xhh...` | 一个或多个数字的十六进制数 |

#### 字符串常量

字符串字面值或常量是括在双引号 "" 中的。一个字符串包含类似于字符常量的字符：普通的字符、转义序列和通用的字符。

可以使用空格做分隔符，把一个很长的字符串常量进行分行。

下面三种写法是一样的：

```c
(1)"hello, dear"
(2) "hello, \
		dear"
(3) "hello, " "d" "ear"
```

在 C 中，有两种简单的定义常量的方式：

1. 使用 `#define` 预处理器。

   ```c
   #define identifier value
   ```

2. 使用 `const `关键字。

   ```c
   const type variable = value;
   ```

### 存储类型关键字

存储关键字定义 C 程序中变量/函数的范围（可见性）和生命周期。这些说明符放置在它们所修饰的类型之前。 C 程序中可用的存储类：`auto`、`register`、`static`、`extern`。

- `auto `关键字是所有局部变量默认的存储类，只能修饰局部变量。

- `register` 关键字用于定义存储在寄存器中而不是 RAM 中的局部变量。这意味着变量的最大尺寸等于寄存器的大小（通常是一个字），且不能对它应用一元的 '&' 运算符（因为它没有内存位置）。

- `static `关键字指示编译器在程序的生命周期内保持局部变量的存在，而不需要在每次它进入和离开作用域时进行创建和销毁。因此，使用 `static `修饰局部变量可以在函数调用之间保持局部变量的值。`static `修饰符也可以应用于全局变量。当 `static `修饰全局变量时，会使变量的作用域限制在声明它的文件内。

- `extern `存储类用于提供一个全局变量的引用，全局变量对所有的程序文件都是可见的。当您有多个文件且定义了一个可以在其他文件中使用的全局变量或函数时，可以在其他文件中使用 `extern `来得到已定义的变量或函数的引用。可以这么理解，`extern `是用来在另一个文件中声明一个全局变量或函数。`extern `修饰符通常用于当有两个或多个文件共享相同的全局变量或函数的时候，例如：

  第一个文件`main.c`：

  ```c
  #include <stdio.h>
  int count ;
  extern void write_extern();
  main()
  {
  count = 5;
  write_extern();
  }
  ```

  第二个文件`externDemo.c`：

  ```c
  #include <stdio.h>
  extern int count;
  void write_extern(void)
  {
  printf("count is %d\n", count);
  }
  ```

## 运算符

运算符是一种告诉编译器执行特定的数学或逻辑操作的符号。C 语言内置了丰富的运算符，并提供了以下类型的运算符：算术运算符
关系运算符、逻辑运算符、位运算符、赋值运算符、杂项运算符。

### 算数运算符

包括加减乘除、取模、自增、自减运算符。

### 关系运算符

包括等于、不等于、大于、小于、大于等于、小于等于运算符。

### 逻辑运算符

包括逻辑与`&&`、或`||`、非`!`运算符。

### 位运算符

位运算符作用于位，并逐位执行操作。包括位与`&`、位或`|`、异或`^`、位反`~`、左移`<<`、右移`>>`运算符。

### 赋值运算符

包括赋值`=`、`{}=`运算符，其中{}可以是+、-、\*、/、%、<<、>>、&、^、|等运算符

### 杂项运算符

下表列出了 C 语言支持的其他一些重要的运算符，包括 `sizeof `和 `? :`。

| 运算符   | 描述             | 实例                                 |
| -------- | ---------------- | ------------------------------------ |
| sizeof() | 返回变量的大小。 | sizeof(a) 将返回 4，其中 a 是整数。  |
| &        | 返回变量的地址。 | &a; 将给出变量的实际地址。           |
| *        | 指向一个变量。   | *a; 将指向一个变量。                 |
| ? :      | 条件表达式       | 如果条件为真 ? 则值为 X : 否则值为 Y |

### C中的运算符优先级

下表将按运算符优先级从高到低列出各个运算符，具有较高优先级的运算符出现在表格的上面，具有较低优先级的运算符出现在表格的下面。在表达式中，较高优先级的运算符会优先被计算。

| 类别       | 运算符                                           | 结合性   |
| ---------- | ------------------------------------------------ | -------- |
| 后缀       | ()  []  ->  .  ++  - -                           | 从左到右 |
| 一元       | +  -  !  ~  ++  - -  (type)*  &  sizeof          | 从右到左 |
| 乘除       | *  /  %                                          | 从左到右 |
| 加减       | +  -                                             | 从左到右 |
| 移位       | << >>                                            | 从左到右 |
| 关系       | < <=    > >=                                     | 从左到右 |
| 相等       | ==    !=                                         | 从左到右 |
| 位与 AND   | &                                                | 从左到右 |
| 位异或 XOR | ^                                                | 从左到右 |
| 位或 OR    | \|                                               | 从左到右 |
| 逻辑与 AND | &&                                               | 从左到右 |
| 逻辑或 OR  | \|\|                                             | 从左到右 |
| 条件       | ?:                                               | 从右到左 |
| 赋值       | =  +=  -=  *=  /=  %=  >>=   <<=   &=   ^=   \|= | 从右到左 |
| 逗号       | ,                                                | 从左到右 |

## 判断语句

判断结构要求程序员指定一个或多个要评估或测试的条件，以及条件为真时要执行的语句（必需的）和条件为假时要执行的语句（可选的）。

C 语言把任何非零和非空的值假定为 `true`，把零或 `null `假定为 `false`。C 语言提供了以下类型的判断语句：

| 语句             | 描述                                                         |
| ---------------- | ------------------------------------------------------------ |
| if 语句          | 一个 if 语句 由一个布尔表达式后跟一个或多个语句组成。        |
| if...else 语句   | 一个 if 语句 后可跟一个可选的 else 语句，else 语句在布尔表达式为假时执行。 |
| 嵌套 if 语句     | 您可以在一个 if 或 else if 语句内使用另一个 if 或 else if 语句。 |
| switch 语句      | 一个 switch 语句允许测试一个变量等于多个值时的情况。         |
| 嵌套 switch 语句 | 您可以在一个 switch 语句内使用另一个 switch 语句。           |

一个 `switch `语句允许测试一个变量等于多个值时的情况。每个值称为一个 `case`，且被测试的变量会对每个 `switch case` 进行检查。

C 语言中 `switch `语句的语法：

```c
switch(expression){
	case constant-expression :
		statement(s);
		break; /* 可选的 */
	case constant-expression :
		statement(s);
		break; /* 可选的 */
	/* 您可以有任意数量的 case 语句 */
	default : /* 可选的 */
		statement(s);
}
```

switch语句必须遵循下面的规则：
(1) switch 语句中的 expression 必须是一个整型或枚举类型（常量）。
(2) 在一个switch中可以有任意数量的 case 语句。
(3) 每个case后跟一个要比较的值和一个冒号。
(4) case 的 constant-expression 必须与 switch 中的变量具有相同的数据类型，且必须是一个常量或字面量。
(5) 当被测试的变量等于 case 中的常量时，case 后跟的语句将被执行，直到遇到 break 语句为止。
(6) 当遇到 break 语句时，switch 终止，控制流将**跳转到 switch 语句后的下一行**。
(7) **不是每一个 case 都需要包含 break。如果 case 语句不包含 break，控制流将会 继续 后续的 case，直到遇到 break 为止。**
(8) 一个 switch 语句可以有一个可选的 default case，出现在 switch的结尾。default case可用于在上面所有 case 都不为真时执行一个任务。default case 中的break 语句不是必需的。

也可以把一个 `switch `作为一个外部 `switch `的语句序列的一部分，即可以在一个 `switch `语句内使用另一个 `switch `语句。即使内部和外部 `switch `的 `case `常量包含共同的值，也没有矛盾。C 语言中嵌套 `switch `语句的语法：

```c
switch(ch1) {
	case 'A':
		printf("这个 A 是外部 switch 的一部分" );
		switch(ch2) {
			case 'A':
				printf("这个 A 是内部 switch 的一部分" );
				break;
			case 'B': /* 内部 B case 代码 */
		}
		break;
	case 'B': /* 外部 B case 代码 */
}
```

实例：

```c
#include <stdio.h>
int main ()
{
	/* 局部变量定义 */
	int a = 100;
	int b = 200;
	switch(a) {
		case 100:
			printf("这是外部 switch 的一部分\n");
			switch(b) {
				case 200:
					printf("这是内部 switch 的一部分\n");
			}
	}
	printf("a 的准确值是 %d\n", a );
	printf("b 的准确值是 %d\n", b );
	return 0;
}
```

执行上述代码，结果为：

```bash
这是外部 switch 的一部分
这是内部 switch 的一部分
a 的准确值是 100
b 的准确值是 200
```

最后，注意条件运算符的结合方向是自右至左，例如：

```c
a>b ? a : c>d ? c : d;
```

应理解为：

```c
a>b ? a : ( c>d ? c : d );
```

## 循环结构

在C语言中，共有三大常用的程序结构：

- 顺序结构：代码从前往后执行，没有任何“拐弯抹角”；
- 选择结构：也叫分支结构，重点要掌握 if else、switch 以及条件运算符；
- 循环结构：重复执行同一段代码。

C语言提供了以下几种循环类型：

| 循环类型        | 描述                                                         |
| --------------- | ------------------------------------------------------------ |
| while 循环      | 当给定条件为真时，重复语句或语句组。它会在执行循环主体之前测试条件。 |
| for 循环        | 多次执行一个语句序列，简化管理循环变量的代码。               |
| do...while 循环 | 除了它是在循环主体结尾测试条件外，其他与 while 语句类似。    |
| 嵌套循环        | 可以在 while、for 或 do..while 循环内使用一个或多个循环。    |

对于`for`循环：

```c
for(表达式1; 表达式2; 表达式3){
	语句块
}
```

1) 先执行“表达式1”。
2) 再执行“表达式2”，如果它的值为真（非0），则执行循环体，否则结束循环。
3) 执行完循环体后再执行“表达式3”。
4) 重复执行步骤 2) 和 3)，直到“表达式2”的值为假，就结束循环。

> for 循环中的“表达式1（初始化条件）”、“表达式2(循环条件)”和“表达式3（自增或自减）”都是可选项，都可以省略（但分号`;`必须保留）。

## 循环控制语句

使用`while`或`for`循环时，如果想提前结束循环（在不满足结束条件的情况下结束循环），可以使用`break`或`continue`关键字提前结束。

C提供的循环控制语句：

| 控制语句      | 描述                                                         |
| ------------- | ------------------------------------------------------------ |
| break 语句    | 终止循环或 switch 语句，程序流将继续执行紧接着循环或 switch 的下一条语句。 |
| continue 语句 | 告诉一个循环体立刻停止本次循环迭代，重新开始下次循环迭代。   |
| goto 语句     | 将控制转移到被标记的语句。但是不建议在程序中使用 goto 语句。 |

1、C 语言中 `break `语句有以下两种用法：

- 当 `break `语句出现在一个循环内时，循环会立即终止，且程序流将继续执行紧接着循环的下一条语句。
  它也可用于终止 `switch `语句中的一个 `case`。

- 如果使用的是嵌套循环（即一个循环内嵌套另一个循环），`break `语句会停止执行最内层的循环，然后开始执行该块之后的下一行代码。

2、C语言中的 `continue `语句有点像 `break `语句。但它不是强迫终止，`continue `会跳过当前循环中的代码，强迫开始下一次循环。

对于 `for `循环，`continue `语句执行后自增语句仍然会执行。对于 `while `和 `do...while` 循环，`continue `语句会重新执行条件判断语句。

3、C语言中的 `goto`语句允许把控制无条件转移到同一函数内的被标记的语句。语法：

```c
goto label;
...
label: statement;
```

在这里，`label `可以是任何除 C 关键字以外的纯文本，它可以设置在 C 程序中 `goto` 语句的前面或者后面。

注意：在任何编程语言中，都不建议使用 `goto `语句。因为它使得程序的控制流难以跟踪，使程序难以理解和难以修改。任何使用 `goto `语句的程序可以改写成不需要使用 `goto `语句的写法。