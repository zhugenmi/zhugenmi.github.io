---
title: K8s常用命令整理
author: zhugenmi
date: 2025-5-22 11:00 +0800
categories: [Systematic Capacity,TOOLS]
tags: [k8s]
description: 
---

###  **一、节点状态与集群管理**

1. **查看节点状态**

   - ```bash
     kubectl get nodes # 列出所有节点，显示状态（Ready/NotReady）、角色、运行时长等
     ```

     示例：

     ```bash
     kubectl get nodes -o wide # 显示节点IP、OS、内核版本等详情
     ```

   - ```bash
     kubectl describe node <node-name> # 查看节点详细信息，包括资源分配（CPU/内存）、污点（Taints）、事件（Events）及运行中的Pod
     ```

   - ```bash
     kubectl top nodes # 实时监控节点资源使用率（需安装Metrics Server）
     ```

2. **集群健康检查**

   - ```bash
     kubectl cluster-info # 查看控制平面（Master）组件状态
     ```

   - ```bash
     kubectl get cs # 检查核心组件（如etcd、scheduler）健康状态
     ```

------

###  **二、资源查看与操作**

1. **Pod管理**

   |                           命令                           |             说明              |                             示例                             |
   | :------------------------------------------------------: | :---------------------------: | :----------------------------------------------------------: |
   |           `kubectl get pods [-n <namespace>]`            |          列出Pod列表          |        `kubectl get pods -l app=nginx`（按标签过滤）         |
   |            `kubectl describe pod <pod-name>`             | 查看Pod详情（事件、容器状态） |         `kubectl describe pod nginx-5dfd64c7b-abcx1`         |
   | `kubectl delete pod <pod-name> --force --grace-period=0` |         强制删除 Pod          | `kubectl delete pod ts-order-other-service-6666b4d4d-lt8rx -n train-ticket --force --grace-period=0` |
   |        `kubectl logs <pod-name> [-c <container>]`        |         查看容器日志          |           `kubectl logs nginx-pod -f`（实时跟踪）            |
   |           `kubectl exec -it <pod-name> -- sh`            |        进入Pod的Shell         |              `kubectl exec -it redis-pod -- sh`              |

   

2. **Deployment/Service管理**

   Deployment

   - ```bash
     kubectl get deployments # 列出部署
     ```

   - ```bash
     kubectl rollout status deployment/<name> # 检查滚动更新状态
     ```

   - ```bash
     kubectl scale deployment/<name> --replicas=3 # 扩缩容副本数
     ```

   Service

   - ```bash
     kubectl get services # 列出服务（ClusterIP/NodePort/LoadBalancer）
     ```

   - ```bash
     kubectl expose deployment nginx --port=80 # 将Deployment暴露为服务
     ```

------

###  **三、配置与存储管理**

1. **ConfigMap/Secret**

   - ```bash
     kubectl create configmap <name> --from-file=config.properties # 从文件创建配置
     ```

   - ```bash
     kubectl get secrets # 查看敏感数据（如密码、Token）
     ```

2. **持久卷（PV/PVC）**

   - ```bash
     kubectl get pv # 查看持久卷及声明状态
     ```

     ```bash
     kubectl get pvc # 查看持久卷及声明状态
     ```

   - ```bash
     kubectl describe pvc <pvc-name> # 检查PVC绑定问题
     ```

------

###  **四、故障排查与调试**

1. **事件与日志分析**

   - ```bash
     kubectl get events --sort-by='.metadata.creationTimestamp' # 按时间排序查看集群事件（如Pod启动失败）
     ```

   - ```bash
     kubectl logs <pod-name> --previous # 查看前一个容器的日志（适用于崩溃的Pod）
     ```

2. **网络与服务诊断**

   - ```bash
     kubectl get endpoints <service-name> # 检查Service是否关联到Pod
     ```

   - ```bash
     kubectl port-forward svc/nginx 8080:80 # 本地端口转发测试服务连通性
     ```

------

### **五、调度与维护**

1. **节点维护**

   - ```bash
     kubectl cordon <node-name> # 标记节点不可调度
     ```

   - ```bash
     kubectl drain <node-name> --ignore-daemonsets # 安全排空节点（驱逐Pod）
     ```

   - ```bash
     kubectl uncordon <node-name> # 恢复节点调度
     ```

2. **污点（Taint）管理**

   - ```bash
     kubectl taint nodes node1 key=value:NoSchedule # 添加污点
     ```

   - ```bash
     kubectl taint nodes node1 key:NoSchedule- # 删除污点
     ```

#### Pod镜像拉取失败

比如，某一个pod初始化失败，使用命令`kubectl describe pod <pod-name> -n <namespace>`查看对应的Events内容如下：

```bash
Events:
  Type     Reason     Age                From               Message
  ----     ------     ----               ----               -------
  Normal   Scheduled  99s                default-scheduler  Successfully assigned monitoring/prometheus-kube-prometheus-admission-create-mwdp9 to ubuntu
  Warning  Failed     68s                kubelet            Failed to pull image "registry.k8s.io/ingress-nginx/kube-webhook-certgen:v1.6.0": failed to pull and unpack image "registry.k8s.io/ingress-nginx/kube-webhook-certgen:v1.6.0": failed to resolve reference "registry.k8s.io/ingress-nginx/kube-webhook-certgen:v1.6.0": failed to do request: Head "https://us-west2-docker.pkg.dev/v2/k8s-artifacts-prod/images/ingress-nginx/kube-webhook-certgen/manifests/v1.6.0": dial tcp 74.125.142.82:443: i/o timeout
  Normal   Pulling    55s (x2 over 99s)  kubelet            Pulling image "registry.k8s.io/ingress-nginx/kube-webhook-certgen:v1.6.0"
  Warning  Failed     25s (x2 over 68s)  kubelet            Error: ErrImagePull
  Warning  Failed     25s                kubelet            Failed to pull image "registry.k8s.io/ingress-nginx/kube-webhook-certgen:v1.6.0": rpc error: code = DeadlineExceeded desc = failed to pull and unpack image "registry.k8s.io/ingress-nginx/kube-webhook-certgen:v1.6.0": failed to resolve reference "registry.k8s.io/ingress-nginx/kube-webhook-certgen:v1.6.0": failed to do request: Head "https://us-west2-docker.pkg.dev/v2/k8s-artifacts-prod/images/ingress-nginx/kube-webhook-certgen/manifests/v1.6.0": dial tcp 74.125.142.82:443: i/o timeout
  Normal   BackOff    10s (x2 over 68s)  kubelet            Back-off pulling image "registry.k8s.io/ingress-nginx/kube-webhook-certgen:v1.6.0"
  Warning  Failed     10s (x2 over 68s)  kubelet            Error: ImagePullBackOff
```

解决方法是修改Job使用的镜像地址，替换为国内可访问的镜像源（如阿里云）：

```bash
kubectl edit job prometheus-kube-prometheus-admission-create -n monitoring
```

将 `image` 字段替换为：


```yaml
   image: registry.aliyuncs.com/google_containers/kube-webhook-certgen:v1.6.0
```

**删除旧Pod触发重建**

```bash
kubectl delete pod prometheus-kube-prometheus-admission-create-mwdp9 -n monitoring
```

   删除后，Job会自动创建新Pod并使用新镜像。